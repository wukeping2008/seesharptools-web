<template>
  <div class="documentation-view">
    <!-- æ–‡æ¡£å¤´éƒ¨ -->
    <div class="doc-header">
      <div class="header-content">
        <h1 class="doc-title">
          <el-icon><Document /></el-icon>
          SeeSharpTools Web æ§ä»¶æ–‡æ¡£
        </h1>
        <p class="doc-subtitle">ä¸“ä¸šæµ‹è¯•æµ‹é‡ä»ªå™¨æ§ä»¶ä½¿ç”¨æŒ‡å—</p>
        
        <!-- å¿«é€Ÿå¯¼èˆª -->
        <div class="quick-nav">
          <el-button-group>
            <el-button @click="scrollToSection('getting-started')">
              <el-icon><VideoPlay /></el-icon>
              å¿«é€Ÿå¼€å§‹
            </el-button>
            <el-button @click="scrollToSection('components')">
              <el-icon><Grid /></el-icon>
              æ§ä»¶åˆ—è¡¨
            </el-button>
            <el-button @click="scrollToSection('download')">
              <el-icon><Download /></el-icon>
              ä¸‹è½½ä¸­å¿ƒ
            </el-button>
          </el-button-group>
        </div>
      </div>
    </div>

    <!-- æ–‡æ¡£å†…å®¹ -->
    <div class="doc-content">
      <!-- å¿«é€Ÿå¼€å§‹ -->
      <section id="getting-started" class="doc-section">
        <h2 class="section-title">
          <el-icon><VideoPlay /></el-icon>
          å¿«é€Ÿå¼€å§‹
        </h2>
        
        <div class="getting-started-grid">
          <el-card class="guide-card">
            <template #header>
              <h3>ğŸš€ å®‰è£…å’Œè®¾ç½®</h3>
            </template>
            <div class="code-block">
              <pre><code># å…‹éš†é¡¹ç›®
git clone https://github.com/wukeping2008/seesharptools-web.git

# è¿›å…¥å‰ç«¯ç›®å½•
cd seesharptools-web/frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev</code></pre>
            </div>
          </el-card>

          <el-card class="guide-card">
            <template #header>
              <h3>ğŸ“¦ NPMåŒ…å®‰è£…</h3>
            </template>
            <div class="code-block">
              <pre><code># å®‰è£…æ§ä»¶åº“
npm install seesharptools-vue

# åœ¨é¡¹ç›®ä¸­å¯¼å…¥
import { Oscilloscope, SignalGenerator } from 'seesharptools-vue'</code></pre>
            </div>
          </el-card>

          <el-card class="guide-card">
            <template #header>
              <h3>ğŸ¯ åŸºç¡€ä½¿ç”¨</h3>
            </template>
            <div class="code-block">
              <pre><code>&lt;template&gt;
  &lt;Oscilloscope 
    :width="1200" 
    :height="800"
    :config="config"
    @config-change="onConfigChange"
  /&gt;
&lt;/template&gt;</code></pre>
            </div>
          </el-card>
        </div>
      </section>

      <!-- æ§ä»¶åˆ—è¡¨ -->
      <section id="components" class="doc-section">
        <h2 class="section-title">
          <el-icon><Grid /></el-icon>
          æ§ä»¶æ–‡æ¡£
        </h2>
        
        <!-- æ§ä»¶åˆ†ç±» -->
        <div class="components-grid">
          <div 
            v-for="category in componentCategories" 
            :key="category.id"
            class="category-section"
          >
            <h3 class="category-title">
              <el-icon>
                <component :is="category.icon" />
              </el-icon>
              {{ category.title }}
            </h3>
            
            <div class="components-list">
              <el-card 
                v-for="component in category.components" 
                :key="component.name"
                class="component-card"
                shadow="hover"
              >
                <template #header>
                  <div class="component-header">
                    <h4>{{ component.name }}</h4>
                    <div class="component-actions">
                      <el-button size="small" @click="downloadComponent(component)">
                        <el-icon><Download /></el-icon>
                        ä¸‹è½½
                      </el-button>
                    </div>
                  </div>
                </template>
                
                <div class="component-content">
                  <p class="component-description">{{ component.description }}</p>
                  
                  <!-- ä½¿ç”¨ç¤ºä¾‹ -->
                  <div class="component-example">
                    <h5>ä½¿ç”¨ç¤ºä¾‹</h5>
                    <div class="code-block">
                      <pre><code>{{ component.example }}</code></pre>
                    </div>
                  </div>
                </div>
              </el-card>
            </div>
          </div>
        </div>
      </section>

      <!-- ä¸‹è½½ä¸­å¿ƒ -->
      <section id="download" class="doc-section">
        <h2 class="section-title">
          <el-icon><Download /></el-icon>
          ä¸‹è½½ä¸­å¿ƒ
        </h2>
        
        <div class="download-grid">
          <!-- å•ä¸ªæ§ä»¶ä¸‹è½½ -->
          <el-card class="download-card">
            <template #header>
              <h3>ğŸ¯ å•ä¸ªæ§ä»¶ä¸‹è½½</h3>
            </template>
            
            <div class="download-content">
              <p>é€‰æ‹©éœ€è¦çš„æ§ä»¶ï¼Œç”Ÿæˆè‡ªå®šä¹‰ä¸‹è½½åŒ…</p>
              
              <div class="component-selector">
                <h4>é€‰æ‹©æ§ä»¶</h4>
                <div class="selector-grid">
                  <el-checkbox-group v-model="selectedComponents">
                    <div 
                      v-for="category in componentCategories" 
                      :key="category.id"
                      class="selector-category"
                    >
                      <h5>{{ category.title }}</h5>
                      <el-checkbox 
                        v-for="component in category.components" 
                        :key="component.name"
                        :label="component.name"
                        :value="component.name"
                      >
                        {{ component.name }}
                      </el-checkbox>
                    </div>
                  </el-checkbox-group>
                </div>
              </div>
              
              <div class="download-actions">
                <el-button 
                  type="primary" 
                  size="large"
                  @click="generateCustomDownload"
                  :disabled="selectedComponents.length === 0"
                >
                  <el-icon><Download /></el-icon>
                  ç”Ÿæˆä¸‹è½½åŒ… ({{ selectedComponents.length }}ä¸ªæ§ä»¶)
                </el-button>
              </div>
            </div>
          </el-card>

          <!-- é¢„è®¾åŒ…ä¸‹è½½ -->
          <el-card class="download-card">
            <template #header>
              <h3>ğŸ“¦ é¢„è®¾åŒ…ä¸‹è½½</h3>
            </template>
            
            <div class="preset-packages">
              <div 
                v-for="preset in presetPackages" 
                :key="preset.id"
                class="preset-item"
              >
                <div class="preset-info">
                  <h4>{{ preset.name }}</h4>
                  <p>{{ preset.description }}</p>
                  <div class="preset-components">
                    <el-tag 
                      v-for="comp in preset.components.slice(0, 3)" 
                      :key="comp"
                      size="small"
                    >
                      {{ comp }}
                    </el-tag>
                    <span v-if="preset.components.length > 3">
                      +{{ preset.components.length - 3 }}ä¸ª
                    </span>
                  </div>
                </div>
                <div class="preset-actions">
                  <el-button @click="downloadPreset(preset)">
                    <el-icon><Download /></el-icon>
                    ä¸‹è½½
                  </el-button>
                </div>
              </div>
            </div>
          </el-card>

          <!-- å®Œæ•´é¡¹ç›®ä¸‹è½½ -->
          <el-card class="download-card">
            <template #header>
              <h3>ğŸš€ å®Œæ•´é¡¹ç›®</h3>
            </template>
            
            <div class="project-download">
              <p>ä¸‹è½½å®Œæ•´çš„SeeSharpTools Webé¡¹ç›®ï¼ŒåŒ…å«æ‰€æœ‰æ§ä»¶å’Œç¤ºä¾‹</p>
              
              <div class="project-options">
                <div class="option-item">
                  <h4>å‰ç«¯é¡¹ç›®</h4>
                  <p>Vue 3 + TypeScript + æ‰€æœ‰æ§ä»¶</p>
                  <el-button type="primary" @click="downloadProject('frontend')">
                    <el-icon><Download /></el-icon>
                    ä¸‹è½½å‰ç«¯é¡¹ç›®
                  </el-button>
                </div>
                
                <div class="option-item">
                  <h4>å®Œæ•´é¡¹ç›®</h4>
                  <p>å‰ç«¯ + åç«¯ + æ–‡æ¡£</p>
                  <el-button type="primary" @click="downloadProject('full')">
                    <el-icon><Download /></el-icon>
                    ä¸‹è½½å®Œæ•´é¡¹ç›®
                  </el-button>
                </div>
              </div>
            </div>
          </el-card>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { 
  Document, VideoPlay, Grid, Download,
  TrendCharts, Monitor, DataAnalysis
} from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'

// å“åº”å¼æ•°æ®
const selectedComponents = ref<string[]>([])

// æ§ä»¶åˆ†ç±»æ•°æ®
const componentCategories = reactive([
  {
    id: 1,
    title: 'åŸºç¡€æ§ä»¶',
    icon: 'DataAnalysis',
    components: [
      {
        name: 'æ•°å­—æ˜¾ç¤ºå™¨',
        description: 'é«˜ç²¾åº¦æ•°å­—æ˜¾ç¤ºæ§ä»¶ï¼Œæ”¯æŒå¤šç§æ•°å€¼æ ¼å¼å’Œå•ä½',
        example: `<template>
  <DigitalDisplay 
    :value="75.234" 
    :precision="3"
    unit="V"
    @value-change="onValueChange"
  />
</template>`
      },
      {
        name: 'çº¿æ€§ä»ªè¡¨',
        description: 'çº¿æ€§åˆ»åº¦ä»ªè¡¨ï¼Œé€‚ç”¨äºå‹åŠ›ã€æ¸©åº¦ç­‰ç‰©ç†é‡æ˜¾ç¤º',
        example: `<template>
  <LinearGauge 
    :value="65" 
    :min="0" 
    :max="100"
    orientation="horizontal"
    unit="Â°C"
  />
</template>`
      },
      {
        name: 'æ¸©åº¦è®¡',
        description: 'æ¸©åº¦æ˜¾ç¤ºæ§ä»¶ï¼Œæ”¯æŒæ‘„æ°åº¦å’Œåæ°åº¦',
        example: `<template>
  <Thermometer 
    :temperature="25.6" 
    unit="C"
    :range="{ min: -20, max: 100 }"
  />
</template>`
      }
    ]
  },
  {
    id: 2,
    title: 'é«˜æ€§èƒ½å›¾è¡¨',
    icon: 'TrendCharts',
    components: [
      {
        name: 'é«˜æ€§èƒ½StripChart',
        description: 'å®æ—¶æ•°æ®æ¡å¸¦å›¾ï¼Œæ”¯æŒå¤§æ•°æ®é‡é«˜é¢‘æ›´æ–°',
        example: `<template>
  <StripChart 
    :data="chartData" 
    :channels="channels"
    :time-span="10"
    :update-rate="100"
    @data-update="onDataUpdate"
  />
</template>`
      },
      {
        name: 'FFTé¢‘è°±åˆ†æ',
        description: 'å¿«é€Ÿå‚…é‡Œå¶å˜æ¢é¢‘è°±åˆ†æå›¾è¡¨',
        example: `<template>
  <SpectrumChart 
    :time-data="signalData" 
    :fft-size="1024"
    window-function="hanning"
    :sample-rate="1000000"
    @fft-result="onFFTResult"
  />
</template>`
      },
      {
        name: 'é¢‘è°±åˆ†æä»ª',
        description: 'ä¸“ä¸šé¢‘è°±åˆ†æä»ªç•Œé¢ï¼Œæ¨¡æ‹ŸçœŸå®ä»ªå™¨',
        example: `<template>
  <SpectrumAnalyzer 
    :frequency="{ start: 0, stop: 1000000 }"
    :amplitude="{ ref: 0, scale: 10 }"
    :span="1000000"
    :rbw="1000"
  />
</template>`
      }
    ]
  },
  {
    id: 3,
    title: 'æ¨¡å—ä»ªå™¨',
    icon: 'Monitor',
    components: [
      {
        name: 'æ•°å­—ç¤ºæ³¢å™¨',
        description: 'ä¸“ä¸šæ•°å­—ç¤ºæ³¢å™¨æ§ä»¶ï¼Œæ”¯æŒå¤šé€šé“æ³¢å½¢æ˜¾ç¤º',
        example: `<template>
  <Oscilloscope 
    :config="scopeConfig" 
    :width="1200" 
    :height="800"
    @config-change="onConfigChange"
    @waveform-data="onWaveformData"
  />
</template>`
      },
      {
        name: 'ä¿¡å·å‘ç”Ÿå™¨',
        description: 'å¤šåŠŸèƒ½ä¿¡å·å‘ç”Ÿå™¨ï¼Œæ”¯æŒå¤šç§æ³¢å½¢ç±»å‹',
        example: `<template>
  <SignalGenerator 
    :config="genConfig"
    :channels="outputChannels"
    @output-change="onOutputChange"
  />
</template>`
      },
      {
        name: 'æ•°å­—ä¸‡ç”¨è¡¨',
        description: 'é«˜ç²¾åº¦æ•°å­—ä¸‡ç”¨è¡¨ï¼Œæ”¯æŒå¤šç§æµ‹é‡åŠŸèƒ½',
        example: `<template>
  <DigitalMultimeter 
    mode="voltage"
    range="auto"
    :auto-range="true"
    @measurement-change="onMeasurement"
  />
</template>`
      }
    ]
  }
])

// é¢„è®¾åŒ…
const presetPackages = reactive([
  {
    id: 1,
    name: 'åŸºç¡€æµ‹é‡åŒ…',
    description: 'åŒ…å«åŸºç¡€æµ‹é‡æ‰€éœ€çš„æ ¸å¿ƒæ§ä»¶',
    components: ['æ•°å­—æ˜¾ç¤ºå™¨', 'çº¿æ€§ä»ªè¡¨', 'æ¸©åº¦è®¡', 'æ•°å­—ä¸‡ç”¨è¡¨']
  },
  {
    id: 2,
    name: 'ä¿¡å·åˆ†æåŒ…',
    description: 'ä¸“ä¸šä¿¡å·åˆ†æå’Œé¢‘è°±åˆ†æå·¥å…·',
    components: ['FFTé¢‘è°±åˆ†æ', 'é¢‘è°±åˆ†æä»ª', 'é«˜æ€§èƒ½StripChart', 'ä¿¡å·å‘ç”Ÿå™¨']
  },
  {
    id: 3,
    name: 'å®Œæ•´ä»ªå™¨åŒ…',
    description: 'æ‰€æœ‰ä¸“ä¸šä»ªå™¨æ§ä»¶çš„å®Œæ•´é›†åˆ',
    components: ['æ•°å­—ç¤ºæ³¢å™¨', 'ä¿¡å·å‘ç”Ÿå™¨', 'æ•°å­—ä¸‡ç”¨è¡¨', 'FFTé¢‘è°±åˆ†æ', 'é¢‘è°±åˆ†æä»ª']
  }
])

// æ–¹æ³•
const scrollToSection = (sectionId: string) => {
  const element = document.getElementById(sectionId)
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' })
  }
}

const downloadComponent = (component: any) => {
  const componentCode = generateComponentCode(component)
  downloadFile(`${component.name}.vue`, componentCode)
  ElMessage.success(`${component.name} ä¸‹è½½å®Œæˆ`)
}

const generateCustomDownload = () => {
  if (selectedComponents.value.length === 0) {
    ElMessage.warning('è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ§ä»¶')
    return
  }
  
  const packageData = generatePackage(selectedComponents.value)
  downloadFile('seesharptools-custom.zip', packageData)
  ElMessage.success(`è‡ªå®šä¹‰åŒ…ä¸‹è½½å®Œæˆ (${selectedComponents.value.length}ä¸ªæ§ä»¶)`)
}

const downloadPreset = (preset: any) => {
  const packageData = generatePackage(preset.components)
  downloadFile(`${preset.name}.zip`, packageData)
  ElMessage.success(`${preset.name} ä¸‹è½½å®Œæˆ`)
}

const downloadProject = (type: string) => {
  const url = 'https://github.com/wukeping2008/seesharptools-web/archive/refs/heads/main.zip'
  window.open(url, '_blank')
  ElMessage.success('é¡¹ç›®ä¸‹è½½å·²å¼€å§‹')
}

// å·¥å…·å‡½æ•°
const generateComponentCode = (component: any) => {
  return `<!-- ${component.name} -->
${component.example}

<script setup lang="ts">
// ${component.description}
// æ›´å¤šé…ç½®è¯·å‚è€ƒæ–‡æ¡£
</script>

<style scoped>
/* è‡ªå®šä¹‰æ ·å¼ */
</style>`
}

const generatePackage = (components: string[]) => {
  return `Package for: ${components.join(', ')}`
}

const downloadFile = (filename: string, content: string) => {
  const blob = new Blob([content], { type: 'text/plain' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = filename
  document.body.appendChild(a)
  a.click()
  document.body.removeChild(a)
  URL.revokeObjectURL(url)
}
</script>

<style lang="scss" scoped>
.documentation-view {
  min-height: 100vh;
  background: var(--background-color);
}

.doc-header {
  background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%);
  color: white;
  padding: 60px 0;
  
  .header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 24px;
    text-align: center;
    
    .doc-title {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }
    
    .doc-subtitle {
      font-size: 20px;
      opacity: 0.9;
      margin-bottom: 40px;
    }
    
    .quick-nav {
      .el-button-group {
        .el-button {
          background: rgba(255, 255, 255, 0.1);
          border-color: rgba(255, 255, 255, 0.2);
          color: white;
          
          &:hover {
            background: rgba(255, 255, 255, 0.2);
          }
        }
      }
    }
  }
}

.doc-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
  
  .doc-section {
    margin: 80px 0;
    
    .section-title {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
  }
}

.getting-started-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
  
  .guide-card {
    .code-block {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 16px;
      
      pre {
        margin: 0;
        color: #d4d4d4;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 14px;
        line-height: 1.5;
      }
    }
  }
}

.components-grid {
  .category-section {
    margin-bottom: 60px;
    
    .category-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .components-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      
      .component-card {
        .component-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          
          h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
          }
          
          .component-actions {
            display: flex;
            gap: 8px;
          }
        }
        
        .component-content {
          .component-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
          }
          
          .component-example {
            .code-block {
              background: #1e1e1e;
              border-radius: 8px;
              padding: 12px;
              
              pre {
                margin: 0;
                color: #d4d4d4;
                font-family: 'Consolas', monospace;
                font-size: 12px;
                line-height: 1.4;
              }
            }
          }
        }
      }
    }
  }
}

.download-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 32px;
  
  .download-card {
    .download-content {
      .component-selector {
        margin-bottom: 24px;
        
        .selector-grid {
          .selector-category {
            margin-bottom: 16px;
            
            h5 {
              font-size: 14px;
              font-weight: 600;
              margin-bottom: 8px;
              color: var(--text-primary);
            }
            
            .el-checkbox {
              display: block;
              margin-bottom: 8px;
            }
          }
        }
      }
      
      .download-actions {
        text-align: center;
      }
    }
    
    .preset-packages {
      .preset-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 12px;
        
        .preset-info {
          flex: 1;
          
          h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 600;
          }
          
          p {
            margin: 0 0 8px 0;
            color: var(--text-secondary);
            font-size: 14px;
          }
          
          .preset-components {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            align-items: center;
            
            span {
              font-size: 12px;
              color: var(--text-secondary);
            }
          }
        }
      }
    }
    
    .project-download {
      .project-options {
        display: grid;
        gap: 20px;
        
        .option-item {
          padding: 20px;
          border: 1px solid var(--border-color);
          border-radius: 8px;
          text-align: center;
          
          h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 600;
          }
          
          p {
            margin: 0 0 16px 0;
            color: var(--text-secondary);
            font-size: 14px;
          }
        }
      }
    }
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 768px) {
  .doc-header {
    padding: 40px 0;
    
    .header-content {
      .doc-title {
        font-size: 32px;
      }
      
      .doc-subtitle {
        font-size: 16px;
      }
      
      .quick-nav {
        .el-button-group {
          display: flex;
          flex-direction: column;
          gap: 8px;
          
          .el-button {
            width: 100%;
          }
        }
      }
    }
  }
  
  .doc-content {
    padding: 0 16px;
    
    .doc-section {
      margin: 40px 0;
      
      .section-title {
        font-size: 24px;
      }
    }
  }
  
  .getting-started-grid,
  .components-list,
  .download-grid {
    grid-template-columns: 1fr;
  }
}
</style>
